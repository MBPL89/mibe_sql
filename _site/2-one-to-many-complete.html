<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr.&nbsp;Bartosiak">

<title>One-to-Many relationship ‚Äì MIBE SQL Corner</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/live-runtime/live-runtime.js" type="module"></script>
<link href="site_libs/quarto-contrib/live-runtime/live-runtime.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/interactive-sql-1.0.0/interactive-sql.css" rel="stylesheet">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="module" src="site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<script src="https://unpkg.com/@antonz/sqlite@3.40.0/dist/sqlite3.js"></script>
<script src="https://unpkg.com/sqlime@0.1.3/dist/sqlime-db.js"></script>
<script src="https://unpkg.com/sqlime@0.1.3/dist/sqlime-examples.js"></script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">MIBE SQL Corner</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-class-materials" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Class materials</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-class-materials">    
        <li>
    <a class="dropdown-item" href="./Introduction.html">
 <span class="dropdown-text">Database Management - Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./1-single-entity.html">
 <span class="dropdown-text">Introduction to SQL. Single entity</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./2-one-to-many.html">
 <span class="dropdown-text">One-to-Many relationship</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./3-many-to-many.html">
 <span class="dropdown-text">Many-to-Many relationship</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./4-server-conn.html">
 <span class="dropdown-text">Server Connections</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./5-one-to-one-and-recursive.html">
 <span class="dropdown-text">One-to-One and Recursive relationship</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./6-many-to-many-recursive.html">
 <span class="dropdown-text">One-to-One and Recursive relationship</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-class-materials---complete" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Class materials - complete</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-class-materials---complete">    
        <li>
    <a class="dropdown-item" href="./1-single-entity-complete.html">
 <span class="dropdown-text">Introduction to SQL. Single entity</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./2-one-to-many-complete.html">
 <span class="dropdown-text">One-to-Many relationship</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./3-many-to-many-complete.html">
 <span class="dropdown-text">Many-to-Many relationship</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./4-server-conn.html">
 <span class="dropdown-text">Server Connections</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./5-one-to-one-and-recursive-complete.html">
 <span class="dropdown-text">One-to-One and Recursive relationship</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./6-many-to-many-recursive-complete.html">
 <span class="dropdown-text">One-to-One and Recursive relationship</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-homeworks" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Homeworks</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-homeworks">    
        <li>
    <a class="dropdown-item" href="./Homework1.html">
 <span class="dropdown-text">Homework 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Homework2.html">
 <span class="dropdown-text">Homework2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Homework3.html">
 <span class="dropdown-text">Homework3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Homework4.html">
 <span class="dropdown-text">Homework4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Homework5.html">
 <span class="dropdown-text">Homework5</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-homework-solutions" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Homework solutions</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-homework-solutions">    
        <li>
    <a class="dropdown-item" href="./Homework1-solution.html">
 <span class="dropdown-text">Homework 1 solution</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Homework2-solution.html">
 <span class="dropdown-text">Homework2 solution</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Homework3-solution.html">
 <span class="dropdown-text">Homework3 solution</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Homework4-solution.html">
 <span class="dropdown-text">Homework4 solution</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-challenges" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Challenges</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-challenges">    
        <li>
    <a class="dropdown-item" href="./4-server-challenge.html">
 <span class="dropdown-text">Server Connections - practice</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-readings" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Readings</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-readings">    
        <li>
    <a class="dropdown-item" href="./Readings.html">
 <span class="dropdown-text">Readings</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#database-modelling" id="toc-database-modelling" class="nav-link active" data-scroll-target="#database-modelling">Database Modelling</a>
  <ul class="collapse">
  <li><a href="#attributes" id="toc-attributes" class="nav-link" data-scroll-target="#attributes">Attributes</a></li>
  <li><a href="#multivalued-attributes" id="toc-multivalued-attributes" class="nav-link" data-scroll-target="#multivalued-attributes">Multivalued attributes</a></li>
  <li><a href="#entity-relaionship" id="toc-entity-relaionship" class="nav-link" data-scroll-target="#entity-relaionship">Entity Relaionship</a></li>
  <li><a href="#one-to-many-relationship" id="toc-one-to-many-relationship" class="nav-link" data-scroll-target="#one-to-many-relationship">One-to-many Relationship</a></li>
  <li><a href="#mapping-to-a-relational-database" id="toc-mapping-to-a-relational-database" class="nav-link" data-scroll-target="#mapping-to-a-relational-database">Mapping to a relational database</a></li>
  </ul></li>
  <li><a href="#database-manipulation" id="toc-database-manipulation" class="nav-link" data-scroll-target="#database-manipulation">Database Manipulation</a>
  <ul class="collapse">
  <li><a href="#aggregate-functions" id="toc-aggregate-functions" class="nav-link" data-scroll-target="#aggregate-functions">Aggregate functions</a></li>
  <li><a href="#joining-tables" id="toc-joining-tables" class="nav-link" data-scroll-target="#joining-tables">JOINing tables</a></li>
  <li><a href="#grouping-the-results" id="toc-grouping-the-results" class="nav-link" data-scroll-target="#grouping-the-results">Grouping the results</a></li>
  <li><a href="#subqueries" id="toc-subqueries" class="nav-link" data-scroll-target="#subqueries">Subqueries</a></li>
  <li><a href="#extra-practice-cell" id="toc-extra-practice-cell" class="nav-link" data-scroll-target="#extra-practice-cell">Extra practice cell</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">One-to-Many relationship</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dr.&nbsp;Bartosiak </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="database-modelling" class="level1">
<h1>Database Modelling</h1>
<p>Now that you‚Äôve learned how to model a basic, single-entity database, let‚Äôs explore <strong>attributes</strong>, which define the characteristics of an entity.</p>
<section id="attributes" class="level2">
<h2 class="anchored" data-anchor-id="attributes">Attributes</h2>
<p>Attributes store important details about each record in a table, helping to describe and organize data effectively.</p>
<p>In a database, attributes can be classified based on whether they require a value. A <strong>required</strong> attribute must always have a value and cannot be left empty, while an <strong>optional</strong> attribute can be left empty (<strong>NULL</strong>).</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>We use <strong>NULL</strong> to indicate missing values. Missing values can occur for different reasons, such as an existing attribute without data (e.g., a middle name) or an inapplicable condition (e.g., an apartment number for a house address).</p>
<p>Don‚Äôt confuse NULL values with blank or zero.</p>
<p>Multiple meanings:</p>
<ul>
<li>Unknown data</li>
<li>Inapplicable data</li>
<li>No value supplied</li>
<li>Value undefined</li>
</ul>
<p>We will come back to NULL values later.</p>
</div>
</div>
<p>Each attribute has a <strong>domain</strong>, which defines the set of possible values it can take.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>A domain is the set of possible values that an attribute can have. Think of it like a rule that defines what kind of data is allowed in a column. For example, if you have an attribute ‚ÄúAge,‚Äù its domain might be whole numbers between 0 and 120. If you have a ‚ÄúCountry‚Äù attribute, its domain would be a list of valid country names. Domains help keep data consistent and prevent errors, like entering text in a column meant for numbers.</p>
</div>
</div>
<p>To uniquely identify each record, <strong>identifiers</strong> are used‚Äîthese are attributes that hold unique values for each instance. In relational databases, the primary key serves as this unique identifier.</p>
<p>Sometimes, a <strong>composite identifier</strong> is needed, which combines two or more attributes to uniquely identify a record (e.g., a combination of Course ID and Student ID to track enrollments).</p>
<p>Attributes can be classified into different types:</p>
<ul>
<li><strong>Composite attribute</strong>: Attribute that can be subdivided to yield additional attributes</li>
<li><strong>Simple attribute</strong>: Attribute that cannot be subdivided</li>
<li><strong>Derived attribute</strong>: Attribute whose value is calculated from other attributes
<ul>
<li>Derived using an algorithm (i.e., Yield = Dividend * Quantity)</li>
<li>Sometimes called ‚Äòcalculated fields‚Äô</li>
</ul></li>
<li><strong>Single-valued attribute</strong>: Attribute that holds only a single value</li>
<li><strong>Multivalued attributes</strong>: Attributes that hold many values</li>
</ul>
<p>Understanding these attribute types is essential for designing efficient databases that accurately represent real-world scenarios.</p>
</section>
<section id="multivalued-attributes" class="level2">
<h2 class="anchored" data-anchor-id="multivalued-attributes">Multivalued attributes</h2>
<p>Think of the data scientists database we modeled last week.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/dsmodel1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="250"></p>
</figure>
</div>
<p>How would the model change, if our data scientist could get a second degree? Or multiple certificates?</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/dsmodel2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="350"></p>
</figure>
</div>
</div>
</div>
</div>
<p>A multivalued attribute is an attribute that can have multiple values for a single entity. For example, an employee might have multiple phone numbers or an author might write multiple books. In database design, multivalued attributes should be handled properly to maintain data consistency. One approach is to create separate attributes for each component of the multivalued attribute (e.g., <code>Phone_1</code>, <code>Phone_2</code>). A better approach is to create a new entity that holds the multiple values, linking it to the original entity through a relationship (e.g., an <code>Employee_Phone</code> table linked to an <code>Employee</code> table). This ensures better organization, eliminates redundancy, and improves data integrity.</p>
<p>Now, try to apply that knowledge to our data scientists database.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/dsmodel3.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="350"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="entity-relaionship" class="level2">
<h2 class="anchored" data-anchor-id="entity-relaionship">Entity Relaionship</h2>
<p>There is one more new thing in the model above. Habe you noticed that the entities are ‚Äúlinked‚Äù. These are entity relationships.</p>
<p>In database design, relationships define how different entities (tables) are associated with one another. These relationships follow <strong>business rules</strong>, which describe how entities interact based on real-world scenarios. For example:</p>
<ul>
<li>a customer can place many orders</li>
<li>a team can have many players.</li>
</ul>
<p>These relationships help ensure that data is properly structured and connected.</p>
<p>A key characteristic of relationships is that they are <strong>bi-directional</strong>, meaning they should always be read both ways. For example, while a customer can place many orders, each order is placed by only one customer. Understanding relationships in both directions is crucial for designing a clear and logical database structure.</p>
<p>Properly defining entity relationships improves data integrity, reduces redundancy, and enhances query efficiency. By embedding relationships directly into the database design, businesses can enforce rules and constraints that reflect real-world operations, making data retrieval and management more efficient.</p>
<p>Consider our brand table from last week. Let‚Äôs say we want to track also info about lodging chains.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/brand2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="images/brand2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="750"></a></p>
</figure>
</div>
<p>Since we have multiple hotels owned by the same chain, storing this information in one table would create redundancies.</p>
<p>It is better to create a new entity, and specify the relationship beween the two.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/brandchain.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="450"></p>
</figure>
</div>
</section>
<section id="one-to-many-relationship" class="level2">
<h2 class="anchored" data-anchor-id="one-to-many-relationship">One-to-many Relationship</h2>
<p>This particular case of relationship is called <strong>one-to-many</strong> relationship.</p>
<p>A one-to-many relationship means that one record in a table is linked to many records in another table. Like in our case, one lodging chain can own many hotels, but each hotel belongs to only one chain. See the example of Hilton Hotels:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/brandchain2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="images/brandchain2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="750"></a></p>
</figure>
</div>
<p>This type of relationship helps organize data efficiently, avoiding duplication and ensuring consistency.</p>
<p>Let‚Äôs go back to our stock portfolio table for a second. Remember that it contains stock market data that is used by an investment firm dealing with international commodities and agricultural products.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/anomalies_table.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Stock market data"><img src="images/anomalies_table.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="700" alt="Stock market data"></a></p>
</figure>
</div>
<figcaption>Stock market data</figcaption>
</figure>
</div>
<p>We said that there might be several problems (called <em>anomalies</em>) with it:</p>
<ul>
<li><strong>Insertion</strong> anomalies occur when adding new data is difficult due to missing dependencies.</li>
<li><strong>Update</strong> anomalies lead to inconsistencies when changes must be made in multiple places.</li>
<li><strong>Deletion</strong> anomalies cause unintended data loss when removing a record also removes critical information.</li>
</ul>
<p>Let‚Äôs try to design a database to store our stock portfolio data!</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/nation1tm.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="350"></p>
</figure>
</div>
</div>
</div>
</div>
<section id="exercise" class="level3">
<h3 class="anchored" data-anchor-id="exercise">Exercise</h3>
<p>Develop a data model for Marriott International to keep track of relevant information about its portfolio of hotels</p>
<p>Focus on the assets, not on customers, employees, or transactions</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/marriott.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="images/marriott.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="550"></a></p>
</figure>
</div>
</section>
<section id="hierarchical-relationships" class="level3">
<h3 class="anchored" data-anchor-id="hierarchical-relationships">Hierarchical relationships</h3>
<p><strong>Hierarchical relationships</strong> occur frequently in databases and follow a one-to-many structure, where one entity has multiple related entities beneath it. This structure is similar to a tree, where a parent node can have multiple child nodes, but each child has only one parent. For example, in a company database, one manager oversees many employees, but each employee has only one direct manager. Similarly, a firm can have many divisions, a division can have many departments, and a department can have many sections (see the example below).</p>
<p>These relationships help organize data logically and efficiently, making it easier to navigate and retrieve information.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/hierarchical.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="images/hierarchical.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="550"></a></p>
</figure>
</div>
</section>
</section>
<section id="mapping-to-a-relational-database" class="level2">
<h2 class="anchored" data-anchor-id="mapping-to-a-relational-database">Mapping to a relational database</h2>
<p>So far, we covered a lot of abstract terms like entity, instances, attributes etc. As you correctly notice, we could simply say table, row, and columns instead. However, there is a good reason for using these abstract terms.</p>
<p>Understanding <strong>entities, instances, and attributes</strong> rather than just <strong>tables, rows, and columns</strong> is important because it helps us focus on the <strong>conceptual meaning of the data</strong> rather than just its storage format.</p>
<ul>
<li><strong>Entity vs.&nbsp;Table:</strong> An <strong>entity</strong> represents a real-world object or concept (like a ‚ÄúCustomer‚Äù or ‚ÄúProduct‚Äù), while a <strong>table</strong> is just how we store data in a database. Thinking in terms of entities helps us design better database models before deciding how to implement them.<br>
</li>
<li><strong>Instance vs.&nbsp;Row:</strong> An <strong>instance</strong> is a specific example of an entity (e.g., a particular customer, ‚ÄúJohn Doe‚Äù). A <strong>row</strong> is how that instance is stored in a table. Thinking in terms of instances makes it easier to understand relationships between data.<br>
</li>
<li><strong>Attribute vs.&nbsp;Column:</strong> An <strong>attribute</strong> describes a characteristic of an entity (e.g., a customer‚Äôs ‚ÄúName‚Äù or ‚ÄúEmail‚Äù). A <strong>column</strong> is just where this data is stored. By focusing on attributes first, we ensure that all necessary information is captured properly.</li>
</ul>
<p>By using these <strong>abstract concepts</strong>, we can design flexible and well-structured databases <strong>before</strong> deciding how to implement them in a specific DBMS.</p>
<section id="mapping-entities-to-tables" class="level4">
<h4 class="anchored" data-anchor-id="mapping-entities-to-tables">Mapping Entities to Tables</h4>
<p>When designing a relational database, entities and their relationships are translated into tables and columns. The process follows these key steps:</p>
<ul>
<li><strong>Each entity becomes a table</strong><br>
</li>
<li><strong>The entity name becomes the table name</strong><br>
</li>
<li><strong>Each attribute becomes a column</strong></li>
</ul>
</section>
<section id="handling-one-to-many-relationships" class="level4">
<h4 class="anchored" data-anchor-id="handling-one-to-many-relationships">Handling One-to-Many Relationships</h4>
<p>In a one-to-many relationship, we structure the tables as follows:</p>
<ul>
<li><strong>Add a column to the table on the ‚Äúmany‚Äù side of the relationship</strong><br>
</li>
<li><strong>Store the identifier of the ‚Äúone‚Äù side in this added column</strong></li>
</ul>
<p>This ensures proper linkage between related data while maintaining database integrity.</p>
</section>
<section id="parsimonious-notation" class="level4">
<h4 class="anchored" data-anchor-id="parsimonious-notation">Parsimonious notation</h4>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>The conceptual database model uses a parsimonious notation, meaning that extra attributes do not need to be explicitly modeled, as they can be inferred from the relationship.</p>
</div>
</div>
<div>

</div>
<div class="quarto-layout-panel" data-layout="[ 40, 60 ]">
<div class="quarto-layout-row">
<div id="first-column" class="quarto-layout-cell" style="flex-basis: 40.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/brandchain.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="images/brandchain.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></a></p>
</figure>
</div>
</div>
<div id="second-column" class="quarto-layout-cell" style="flex-basis: 60.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/brandchain2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="images/brandchain2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></a></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="integrity-constraint" class="level4">
<h4 class="anchored" data-anchor-id="integrity-constraint">Integrity constraint</h4>
<p>Ensuring data integrity is crucial in relational databases. <strong>Entity integrity</strong> maintains the uniqueness and validity of primary keys, while <strong>referential integrity</strong> ensures that foreign keys correctly reference existing primary keys. These rules help prevent inconsistencies and maintain reliable relationships between tables.</p>
<section id="entity-integrity" class="level5">
<h5 class="anchored" data-anchor-id="entity-integrity">Entity Integrity</h5>
<ul>
<li>A <strong>primary key</strong> must be <strong>unique</strong>.<br>
</li>
<li>Primary keys <strong>can never have NULL values</strong>.</li>
</ul>
</section>
<section id="referential-integrity" class="level5">
<h5 class="anchored" data-anchor-id="referential-integrity">Referential Integrity</h5>
<ul>
<li>For every <strong>non-null value</strong> of a <strong>foreign key</strong>, there must be a <strong>matching primary key</strong> with that value.<br>
</li>
<li><strong>Example:</strong> For every value of <code>chainID</code> in the <code>brand</code> table, there must be a corresponding value of <code>chainID</code> in the <code>lodgingChain</code> table.<br>
</li>
<li>A <strong>primary key must exist</strong> before a foreign key can be defined.</li>
</ul>
<p>##Implementable database model</p>
<p>Remember these beatiful drawings?</p>
<div id="fig-elephants" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-elephants-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Conceptual Model.png" class="img-fluid figure-img" width="350"></p>
<figcaption>Hand-drawn crowfoot model</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/ERD.png" class="img-fluid figure-img" width="350"></p>
<figcaption>ER diagram</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-elephants-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1
</figcaption>
</figure>
</div>
<p>So far, we mainly focused on a <strong>conceptual</strong> database model. But there is also <strong>implementational</strong> (or logical) database model.</p>
<p>The <strong>conceptual database model</strong> focuses on the high-level structure of the data, emphasizing entities, relationships, and constraints without considering how the data will be physically stored. It serves as a <em>blueprint</em> for understanding data requirements and is independent of any specific database management system (DBMS). On the other hand, the <strong>implementational database model</strong> translates the conceptual design into a format that a DBMS can use, incorporating tables, columns, keys, and constraints based on a specific database system. While the conceptual model is abstract and business-oriented, the implementational model is detailed and technical, bridging the gap between design and actual database implementation.</p>
<p>We will learn how to design such implementational models in few weeks. First, let‚Äôs learn how to read them.</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout="[ 60, 40 ]">
<div class="quarto-layout-row">
<div id="first-column" class="quarto-layout-cell" style="flex-basis: 60.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/implmodel.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" title="An implementational database model"><img src="images/implmodel.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="An implementational database model"></a></p>
</figure>
</div>
<figcaption>An implementational database model</figcaption>
</figure>
</div>
</div>
<div id="second-column" class="quarto-layout-cell" style="flex-basis: 40.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/impllegend.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9" title="Workbench symbolism"><img src="images/impllegend.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Workbench symbolism"></a></p>
</figure>
</div>
<figcaption>Workbench symbolism</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="identifying-and-non-identifying-relationships" class="level3">
<h3 class="anchored" data-anchor-id="identifying-and-non-identifying-relationships">Identifying and non-identifying relationships</h3>
<p>In database modeling, <strong>identifying</strong> and <strong>non-identifying</strong> relationships refer to how entities are related to one another. An identifying relationship occurs when the child entity‚Äôs existence depends on the parent entity, and the child entity‚Äôs primary key includes the parent‚Äôs primary key. This often happens in cases where the child cannot exist without the parent (e.g., an order item cannot exist without an order). In contrast, a non-identifying relationship occurs when the child entity can exist independently of the parent entity, and the child‚Äôs primary key does not include the parent‚Äôs primary key. Here, the relationship is more loosely coupled (e.g., a customer can exist without an address).</p>
<p>In the implementational model, the relationships will look slightly differnt.</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout="[ 50, 50 ]">
<div class="quarto-layout-row">
<div id="first-column" class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/identify.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="images/identify.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></a></p>
</figure>
</div>
</div>
<div id="second-column" class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/nonidentify.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="images/nonidentify.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></a></p>
</figure>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the conceptual model, we will have to add a small plus (+) over a relationship, to mark the identifying relationship.</p>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/pluscrowfoot.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="250"></p>
</figure>
</div>
</section>
</section>
</section>
<section id="database-manipulation" class="level1">
<h1>Database Manipulation</h1>
<p>This week we will start querying models that are slightly more advanced. You know now, that we can have models with more than one table and a relationship between them. Our hotel database evolved accordingly and we now store the data about lodging chaing in a separate table called <em>lodgingChain</em>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/modelsession2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="450"></p>
</figure>
</div>
<section id="aggregate-functions" class="level2">
<h2 class="anchored" data-anchor-id="aggregate-functions">Aggregate functions</h2>
<p>In SQL aggregate functions help you combine lots of data into one result. These are like math operations that work on whole columns of information instead of just single values.</p>
<p>Here are the main aggregate functions:</p>
<ul>
<li><strong>COUNT()</strong>: Tells you how many items are in your data (like counting how many customers you have)</li>
<li><strong>SUM()</strong>: Adds up numbers (like finding your total sales for the month)</li>
<li><strong>AVG()</strong>: Calculates the average (like finding the typical price of products)</li>
<li><strong>MIN()</strong>: Finds the smallest value (like identifying your cheapest item)</li>
<li><strong>MAX()</strong>: Finds the largest value (like identifying your most expensive item)</li>
</ul>
<p>These functions are super helpful when you want to get quick summaries from your database without looking at every single row of information. You simply add the to your query follwoing this pattern:</p>
<div class="interactive-sql">
<div class="sourceCode" id="cb1"><pre class="sourceCode sql interactive hr2-not-editable code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">FUNCTION</span>(columnName) <span class="kw">FROM</span> tableName;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let‚Äôs test them in our <em>brand</em> table!</p>
<p><em>Find the average hotel room square footage for all brands.</em></p>
<div class="interactive-sql">
<div class="sourceCode" id="cb2"><pre class="sourceCode sql interactive hr2 code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">AVG</span>(brandMinSqFt) <span class="kw">AS</span> avgArea <span class="kw">FROM</span> brand;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>What is the area of the largest hotel room specification in the DB? Rename as ‚ÄúBiggest Room‚Äù</em></p>
<div class="interactive-sql">
<div class="sourceCode" id="cb3"><pre class="sourceCode sql interactive hr2 code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">MAX</span>(brandMinSqFt) <span class="kw">AS</span> <span class="st">'Biggest Room'</span> <span class="kw">FROM</span> brand;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>How many total brands do we have data for?</em></p>
<div class="interactive-sql">
<div class="sourceCode" id="cb4"><pre class="sourceCode sql interactive hr2 code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>)<span class="kw">FROM</span> brand;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The query below is an equivalent to the previous one. Can you explain why?</p>
</div>
</div>
<div class="interactive-sql">
<div class="sourceCode" id="cb5"><pre class="sourceCode sql interactive hr2 code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(brandName)<span class="kw">FROM</span> brand;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>What is the total number of hotel rooms? - All rooms of all chains.</em></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The solve this task, you will have to query different table‚Ä¶</p>
</div>
</div>
<div class="interactive-sql">
<div class="sourceCode" id="cb6"><pre class="sourceCode sql interactive hr2 code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">SUM</span>(numRooms) <span class="kw">FROM</span> lodgingchain;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="joining-tables" class="level2">
<h2 class="anchored" data-anchor-id="joining-tables">JOINing tables</h2>
<p>Joining tables in SQL allows you to <em>combine related data from different tables</em> into a single result set. The simplest way to join tables is using the <strong>WHERE</strong> clause with the equals operator (which is great!ü§© because you already know how to use WHERE).</p>
<p>Here‚Äôs how it works:</p>
<ul>
<li><strong>Basic JOIN using WHERE</strong>: You list both tables in the FROM clause and use WHERE to match related columns</li>
<li><strong>Example syntax</strong>: <code>SELECT * FROM brand, lodgingchain WHERE brand.chainID = lodgingchain.chainID;</code></li>
<li><strong>How it works</strong>: This tells SQL to match each row from the first table with rows from the second table where the specified columns have the same value</li>
<li><strong>Result</strong>: Only rows where the join condition is true appear in your results</li>
</ul>
<p>This approach creates what‚Äôs known as an ‚Äúinner join‚Äù - it only shows data where there are matches between both tables. We will explore more powerful ways to join tables in our next session.</p>
<p><em>Try it yourself!</em></p>
<div class="interactive-sql">
<div class="sourceCode" id="cb7"><pre class="sourceCode sql interactive hr2 code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> brand, lodgingchain </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">WHERE</span> brand.chainID <span class="op">=</span> lodgingchain.chainID;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exercise-1" class="level3">
<h3 class="anchored" data-anchor-id="exercise-1">Exercise</h3>
<p><em>Report the headquarter location of each brand‚Äôs parent chain.Order by brand name.</em></p>
<div class="interactive-sql">
<div class="sourceCode" id="cb8"><pre class="sourceCode sql interactive hr2 code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> brandName, headquarters</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> brand,lodgingchain</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> brand.chainID <span class="op">=</span> lodgingchain.chainID</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ORDER</span> <span class="kw">BY</span> brandName;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Watch out for cross-products
</div>
</div>
<div class="callout-body-container callout-body">
<p>A cross-product in SQL occurs when you join two tables without specifying a join condition. This creates a result set containing every possible combination of rows from both tables. For example, if you run <code>SELECT * FROM brand, lodgingchain;</code> without a WHERE clause, each row from the brand table will be paired with every row from the lodgingchain table. If your brand table has 100 rows and your lodgingchain table has 500 rows, you‚Äôll end up with 50,000 rows in your result set.</p>
<p>Cross-products are rarely useful in practical applications and can cause serious performance problems with large tables, which is why properly specifying join conditions with WHERE clauses is essential for efficient queries.</p>
<div class="interactive-sql">
<div class="sourceCode" id="cb9"><pre class="sourceCode sql interactive hr2 code-with-copy"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> brand, lodgingchain;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The risk of homonyms
</div>
</div>
<div class="callout-body-container callout-body">
<p>Homonyms in database design‚Äîparticularly columns with identical names across different tables‚Äîcreate risks. When fields like ‚Äúid‚Äù or ‚Äústatus‚Äù appear in multiple tables but represent different concepts, developers may mistakenly join these columns or apply incorrect business logic. This confusion leads to flawed queries, unpredictable results, and potential data corruption.</p>
<p>To prevent these issues, best practices include using descriptive, context-specific column names (e.g., ‚Äúcustomer_id‚Äù instead of just ‚Äúid‚Äù), implementing consistent naming conventions, and maintaining clear documentation of each column‚Äôs specific meaning and purpose.</p>
<p>However, sometimes you may find a database with homonyms. Let‚Äôs take a look at our nation-stock database. Try to run the query below. What is the result? How would you change the query to get the correct result?</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/implnatstock.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="images/implnatstock.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="250"></a></p>
</figure>
</div>
<div class="interactive-sql">
<div class="sourceCode" id="cb10"><pre class="sourceCode sql interactive ns code-with-copy"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> stock, nation</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> stock.natcode <span class="op">=</span> nation.natcode;</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="grouping-the-results" class="level2">
<h2 class="anchored" data-anchor-id="grouping-the-results">Grouping the results</h2>
<p>The <strong>GROUP BY</strong> clause in SQL allows you to organize similar data into groups and perform aggregate functions on each group separately rather than on the entire table.</p>
<p>Here‚Äôs how it works:</p>
<ul>
<li><strong>Basic purpose</strong>: Groups rows that have the same values in specified columns</li>
<li><strong>Typical usage</strong>: Used with aggregate functions (COUNT, SUM, AVG, etc.) to perform calculations on each group</li>
<li><strong>Example syntax</strong>: <code>SELECT chainHQ, COUNT(*) FROM lodgingChaing GROUP BY chainHQ;</code></li>
<li><strong>Result</strong>: One row for each unique value in the grouped column(s)</li>
<li><strong>Multiple columns</strong>: You can group by multiple columns like <code>GROUP BY department, job_title</code></li>
<li><strong>Common requirement</strong>: Generally, columns in the SELECT list must either be part of the GROUP BY clause or used within an aggregate function</li>
</ul>
<div class="interactive-sql">
<div class="sourceCode" id="cb11"><pre class="sourceCode sql interactive hr2 code-with-copy"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> headquarters, <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">FROM</span> lodgingchain </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">GROUP</span> <span class="kw">BY</span> headquarters;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>GROUP BY</strong> is essential for summarizing data and generating reports that show totals, averages, or counts for different categories within your data.</p>
<section id="exercise-2" class="level4">
<h4 class="anchored" data-anchor-id="exercise-2">Exercise</h4>
<p><em>Report number of brands in each chain by chain name (not chainID).</em></p>
<div class="interactive-sql">
<div class="sourceCode" id="cb12"><pre class="sourceCode sql interactive hr2 code-with-copy"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> chainName, <span class="fu">COUNT</span>(brandName) <span class="kw">AS</span> NumBrands</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> brand, lodgingchain </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> brand.chainID <span class="op">=</span> lodgingchain.chainID</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span> chainName;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="having" class="level3">
<h3 class="anchored" data-anchor-id="having">HAVING</h3>
<p>In SQL, the <code>HAVING</code> clause is used to filter the results of a <code>GROUP BY</code> query. It is like <code>WHERE</code> clause for grouped results. However, <code>HAVING</code> allows you to filter groups based on aggregate functions (like <code>COUNT()</code>, <code>SUM()</code>, <code>AVG()</code>, etc.), which cannot be done using the <code>WHERE</code> clause.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>WHERE</code> clause filters rows before they are grouped, while <code>HAVING</code> filters groups after the aggregation is done.</p>
</div>
</div>
<p>Consider the previous example. We can easily filter the results and keep only, for example, countries with at least 3 headquarters.</p>
<div class="interactive-sql">
<div class="sourceCode" id="cb13"><pre class="sourceCode sql interactive hr2 code-with-copy"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> headquarters, <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">FROM</span> lodgingchain </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">GROUP</span> <span class="kw">BY</span> headquarters</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">HAVING</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="op">&gt;=</span> <span class="dv">3</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exercise-3" class="level4">
<h4 class="anchored" data-anchor-id="exercise-3">Exercise</h4>
<p><em>Report the average room area and number of brands for all chains that own more than one brand</em></p>
<div class="interactive-sql">
<div class="sourceCode" id="cb14"><pre class="sourceCode sql interactive hr2 code-with-copy"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> chainName, <span class="fu">AVG</span>(brandMinSqFt) <span class="kw">AS</span> avgArea, <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> totalBrands</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> brand, lodgingchain </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> lodgingchain.chainID <span class="op">=</span> brand.chainID  </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span> chainName </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">HAVING</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="op">&gt;=</span> <span class="dv">2</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="subqueries" class="level2">
<h2 class="anchored" data-anchor-id="subqueries">Subqueries</h2>
<p>A <strong>subquery</strong> is a query that is nested inside another query. It is used to retrieve data that will be used in the main query for filtering, selecting, or computing results. Subqueries can be placed in the <code>SELECT</code>, <code>FROM</code>, or <code>WHERE</code> clauses of a SQL query.</p>
<p>There are two main types of subqueries: 1. <strong>Scalar subqueries</strong>: Return a single value. 2. <strong>Table subqueries</strong>: Return multiple rows and columns.</p>
<p>For now, we will only focus on scalar subqueries.</p>
<p><strong>When to Use Subqueries</strong>:</p>
<ul>
<li>When you need to compare a value in a column with a result from another query.</li>
<li>When you want to perform an operation on a subset of data before using it in the main query.</li>
<li>When a join is not possible or too complex to use.</li>
</ul>
<section id="example-of-a-subquery-in-the-where-clause" class="level3">
<h3 class="anchored" data-anchor-id="example-of-a-subquery-in-the-where-clause">Example of a Subquery in the <code>WHERE</code> Clause:</h3>
<p><em>Report the name of all brands headquartered in the same country as the Grand Hyatt.</em></p>
<div class="interactive-sql">
<div class="sourceCode" id="cb15"><pre class="sourceCode sql interactive hr2 code-with-copy"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> brandName <span class="kw">FROM</span> lodgingChain, brand </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">WHERE</span> lodgingChain.chainID <span class="op">=</span> brand.chainID </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">AND</span> headquarters <span class="kw">IN</span> (<span class="kw">SELECT</span> headquarters </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                <span class="kw">FROM</span> lodgingChain, brand</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                <span class="kw">WHERE</span> lodgingChain.chainID <span class="op">=</span> brand.chainID </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                <span class="kw">AND</span> brandName<span class="op">=</span><span class="st">'Grand Hyatt'</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A subquery in the <code>WHERE</code> clause can be used to filter results based on data from another table. You can run the subquery as a separate query and see its results.</p>
<div class="interactive-sql">
<div class="sourceCode" id="cb16"><pre class="sourceCode sql interactive hr2 code-with-copy"><code class="sourceCode sql"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> headquarters <span class="kw">FROM</span> lodgingChain, brand</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">WHERE</span> lodgingChain.chainID <span class="op">=</span> brand.chainID </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">AND</span> brandName<span class="op">=</span><span class="st">'Grand Hyatt'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exercise-4" class="level3">
<h3 class="anchored" data-anchor-id="exercise-4">Exercise</h3>
<p><em>Report all data about the oldest chain with worldwide presence (i.e., founded earliest)</em></p>
<div class="interactive-sql">
<div class="sourceCode" id="cb17"><pre class="sourceCode sql interactive hr2 code-with-copy"><code class="sourceCode sql"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> lodgingchain </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">WHERE</span> yearfounded <span class="op">=</span> (</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> <span class="fu">MIN</span>(yearfounded) <span class="kw">FROM</span> lodgingchain);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="extra-practice-cell" class="level2">
<h2 class="anchored" data-anchor-id="extra-practice-cell">Extra practice cell</h2>
<div class="interactive-sql">
<div class="sourceCode" id="cb18"><pre class="sourceCode sql interactive hr2 code-with-copy"><code class="sourceCode sql"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<div>

</div>
<div class="quarto-layout-panel" data-layout="[ 70, 30 ]">
<div class="quarto-layout-row">
<div id="first-column" class="quarto-layout-cell" style="flex-basis: 70.0%;justify-content: flex-start;">
<p>That‚Äôs it for now, but this is just the beginning! üéâ</p>
<p>There‚Äôs so much more to explore. With each step, you‚Äôll unlock more powerful ways to interact with databases and make sense of data. Keep practicing, stay curious, and get ready for even more exciting topics ahead!</p>
</div>
<div id="second-column" class="quarto-layout-cell" style="flex-basis: 30.0%;justify-content: center;">
<p><img src="gifs/hobbit-adventure.gif" class="img-fluid"></p>
</div>
</div>
</div>
<div class="disclaimer">
<p>
<strong>Images and GIFs Disclaimer:</strong> Some of the images and GIFs used on this website are not owned by me. They are used for educational and illustrative purposes only. All rights belong to their respective owners. If you believe any content violates copyright, please contact me for prompt removal.
</p>
</div>
<style>
.disclaimer {
  font-size: 0.8em;
  color: #666;
  border-top: 1px solid #ddd;
  padding-top: 10px;
  margin-top: 20px;
}
</style>
<div>
<!-- Footer Section -->
<div style="
  width: 100vw;
  height: auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background-color: #f9f9f9;
  font-size: 12px;
  border-top: 1px solid #ddd;
  box-sizing: border-box;
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 10px 20px;
">
  <!-- Left-aligned -->
  <div style="text-align: left; font-size: 16px;">
    ¬© 2025. All Rights Reserved.
  </div>
  

  <!-- Right-aligned -->
  <div style="text-align: right; font-size: 16px;">
    Enabled by Dr. Marcin Bartosiak
  </div>
</div>

<!-- Mobile Responsiveness -->
<style>
  @media screen and (max-width: 768px) {
    div[style*="width: 100vw"] {
      flex-direction: column;
      height: auto;
      padding: 10px 15px;
    }
    
    div[style*="width: 100vw"] > div {
      text-align: center;
      margin-bottom: 5px;
    }
  }
</style>

</div>


<script type="ojs-module-contents">
eyJjb250ZW50cyI6W119
</script>
<div id="exercise-loading-indicator" class="exercise-loading-indicator d-none d-flex align-items-center gap-2">
<div id="exercise-loading-status" class="d-flex gap-2">

</div>
<div class="spinner-grow spinner-grow-sm">

</div>
</div>
<script type="vfs-file">
W10=
</script>
<sqlime-db name="hr2" path="https://raw.githubusercontent.com/MBPL89/dbs/refs/heads/main/htlreviews2.sql"></sqlime-db>
<sqlime-examples db="hr2" selector="div.interactive-sql pre.hr2 code" editable=""></sqlime-examples>
</section>
</section>

</main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W119
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../..";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","loop":false,"descPosition":"bottom","selector":".lightbox","openEffect":"zoom"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




<script src="site_libs/quarto-contrib/interactive-sql-1.0.0/interactive-sql.js"></script>
</body></html>